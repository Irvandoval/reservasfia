<div ng-include="'components/navbar/navbar.html'"></div>
<div class="content-fluid">
  <div class="row">
    <div class="col-md-1"></div>
    <div class="col-md-7">
      <div calendar="calendario" class="span8 calendar" ng-model="eventSources" ui-calendar="uiConfig.calendar"></div>
      <div class="text-center">
        <span aria-hidden="true" class="fa fa-square esperEscuela">
          <b>
            En espera escuela</b>
        </span>
        <span aria-hidden="true" class="fa fa-square esper">
          <b>
            En espera académica</b>
        </span>
        <span aria-hidden="true" class="fa fa-square aprob">
          <b>Aprobados</b>
        </span>
      </div>
    </div>
    <div class="col-md-3">
      <tabset justified="true">
        <tab>
          <tab-heading>
            <i class="fa fa-search"></i>
            Búsqueda
          </tab-heading>
          <h2>Criterios de búsqueda</h2>

          <label class="checkbox-inline">
            <input id="opcion2" name="opciones" ng-click="busqueda.opcion1=false;porAulas()" ng-model="busqueda.opcion2" type="checkbox">
            Aula específica
          </label>
          <div ng-if="busqueda.opcion1">
            <tags-input add-from-autocomplete-only="true" class="bootstrap" ng-model="etiquetas" placeholder="Agrega una etiqueta" replace-spaces-with-dashes="false">
              <auto-complete debounce-delay="0" max-results="10" min-length="0" source="loadTags($query)"></auto-complete>
            </tags-input>
          </div>
          <div ng-if="busqueda.opcion2">
            <tags-input add-from-autocomplete-only="true" class="bootstrap" display-property="nombre" ng-model="aulas" on-tag-added="filtroPorAulas()" on-tag-adding="true" on-tag-removed="filtroPorAulas()" on-tag-removing="true" placeholder="Agrega un aula" replace-spaces-with-dashes="false">
              <auto-complete debounce-delay="0" max-results="10" min-length="0" source="cargarAulas($query)"></auto-complete>
            </tags-input>
          </div>
        </tab>
        <tab ng-click="irvan()" ng-if="esAdmin() || esDocente() || esRepresentante() ">
          <tab-heading>
            <i class="fa fa-list-alt"></i>
            Reservar
          </tab-heading>
          <div id="reservaDiv" ng-if="mostrar">
            <form class="form" name="form" ng-submit="enviar(form)" novalidate>
              <div class="form-group" ng-class="{ 'has-success': form.nombre.$valid && submitted,
                                                  'has-error': form.nombre.$invalid && submitted }">
                <label>Nombre de la actividad</label>
                <input class="form-control" name="nombre" ng-model="actividad.nombre" placeholder="Ej: Evaluado 1"  required type="text"/>
                <p class="help-block" ng-show="form.nombre.$error.required && submitted">
                  Campo requerido
                </p>
              </div>
              <div class="form-group"  ng-class="{ 'has-success': form.asistentes.$valid && submitted,
                                                  'has-error': form.asistentes.$invalid && submitted }">
                <label>Cantidad de Asistentes</label>
                <input class="form-control" name="asistentes" min="1" placeholder="Agrega la cantidad de asistentes" required  ng-model="actividad.asistentes" type="number"/>
                <p class="help-block" ng-show="form.asistentes.$error.required && submitted">
                  Campo requerido
                </p>
              </div>
              <label>Fecha</label>
              <p class="input-group" ng-class="{ 'has-success': form.fecha.$valid && submitted,
                                                  'has-error': form.fecha.$invalid && submitted }">
                <input class="form-control" name="fecha" clear-text="Limpiar" close-text="Cerrar"
                datepicker-popup="fullDate" is-open="datePicker.opened" max-date="'2020-06-22'"
                 min-date="minDate" ng-model="actividad.fecha"  required  readonly="true" type="text"/>

                <span class="input-group-btn">
                  <button class="btn btn-success" ng-click="open($event)" type="button">
                    <i class="glyphicon glyphicon-calendar"></i>
                  </button>
                </span>
                <p class="help-block" ng-show="form.fecha.$error.required && submitted">
                  Campo requerido
                </p>

              </p>
              <div class="row">
                <div class="col-md-5">
                  <label>Inicio</label>
                  <timepicker hour-step="hstep" id="time" minute-step="mstep" mousewheel="false" ng-change="" ng-model="actividad.inicio" show-meridian="false" min="hMin"></timepicker>
                </div>
                <div class="col-md-5">
                  <label>Fin</label>
                  <timepicker hour-step="hstep" id="time" minute-step="mstep" mousewheel="false" ng-model="actividad.fin" show-meridian="false"></timepicker>
                </div>
              </div>
              <div class="form-group" ng-class="{ 'has-success': form.aulas.$valid && submitted,
                                                  'has-error': form.aulas.$invalid && submitted }" >
                <label>Aulas</label>
                <tags-input name="aulas" required add-from-autocomplete-only="true" class="bootstrap" display-property="nombre" ng-model="actividad.aulas" placeholder="Agrega un aula" replace-spaces-with-dashes="false">
                  <auto-complete debounce-delay="0" max-results="10" min-length="0" source="cargarAulas($query)"></auto-complete>
                </tags-input>
                <p class="help-block" ng-show="form.aulas.$error.required && submitted">
                  Campo requerido
                </p>

              </div>
              <div ng-if="esAdmin()">
                <div class="form-group">
                  <label>Escuela</label>
                  <select class="form-control" ng-change="rellenarDocentes(escuela._id)" ng-model="actividad.escuela" ng-repeat="escuela in escuelas">
                    <option value="{{escuela._id}}">{{escuela.nombre}}
                    </option>
                  </select>
                </div>
              </div>
              <div ng-if="esRepresentante() || esAdmin()">
                <div class="form-group">
                  <label>Docente</label>
                  <select class="form-control" ng-change="rellenarMaterias(docente._id)" ng-model="actividad.docente">
                    <option ng-repeat="docente in docentes" value="{{docente}}">{{docente.nombre}}
                    </option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label>Materia</label>
                <select class="form-control" ng-change="materiaActual(materia.nombre)" ng-model="actividad.materia">
                  <option ng-if="materia.imparteEnCiclo == 2 || materia.imparteEnCiclo == 3" ng-repeat="materia in materias" value="{{materia._id}}">
                    {{materia.nombre}}
                  </option>
                </select>
              </div>
              <button class="btn btn-danger form-control" type="submit">
                Enviar</button>
            </form>

          </div>

        </tab>
      </tabset>

    </div>
  </div>
  <toaster-container toaster-options="{'position-class': 'toast-top-right'}"></toaster-container>
</div>
<script id="reserva-detalle.html" type="text/ng-template">
  <div class="modal-header">
    <h3 class="modal-title">Detalle de la actividad</h3>
  </div>
  <div class="modal-body">
    <h2 class="text-center">
      {{actividad.actividad.nombre}}
    </h2>
    <h4 class="text-center">
      <div ng-if="actividad.actividad.tipo === 1">
       Clase
      </div>
      <div ng-if="actividad.actividad.tipo === 2">
       Evaluación
      </div>
    </h4> <br>
    <div class="text-center"><label>Asignatura:</label>
      {{actividad.actividad.materia.nombre}}
    </div> <br>
    <DIV class="text-center"><label for="">Encargado:</label>
      {{actividad.actividad.encargado}}
    </DIV><br>
    <DIV class="text-center"><label>Fecha:</label>
      {{actividad.inicio | date:'fullDate'}}
    </DIV><br>
    <DIV class="text-center"><label for="">Hora de inicio:</label>
      {{actividad.inicio | date:'shortTime'}}
    </DIV><br>
    <DIV class="text-center"><label for="">Hora de fin:</label>
      {{actividad.fin | date:'shortTime'}}
    </DIV><br>
    <DIV class="text-center"><label for="">Aulas:</label>
      <div ng-repeat="aula in actividad.aulas">
        <label for=""> {{aula.nombre}}</label>
      </div>
  </DIV>

</div>
<div class="modal-footer">
  <button class="btn btn-primary" ng-click='ok()'>OK</button>
  <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
</div>
</script>
